---
changelog:
- 2024-01-28, gpt-4-0125-preview, translated from English
date: 2024-01-28 23:55:56.135801-07:00
description: "\u041F\u0440\u043E\u0432\u0435\u0440\u043A\u0430 \u0441\u0443\u0449\u0435\
  \u0441\u0442\u0432\u043E\u0432\u0430\u043D\u0438\u044F \u0434\u0438\u0440\u0435\u043A\
  \u0442\u043E\u0440\u0438\u0438 \u043E\u0437\u043D\u0430\u0447\u0430\u0435\u0442\
  \ \u043F\u043E\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043D\u0438\u0435\
  \ \u043D\u0430\u043B\u0438\u0447\u0438\u044F \u043F\u0430\u043F\u043A\u0438 \u0432\
  \ \u0444\u0430\u0439\u043B\u043E\u0432\u043E\u0439 \u0441\u0438\u0441\u0442\u0435\
  \u043C\u0435. \u041F\u0440\u043E\u0433\u0440\u0430\u043C\u043C\u0438\u0441\u0442\
  \u044B \u0434\u0435\u043B\u0430\u044E\u0442 \u044D\u0442\u043E, \u0447\u0442\u043E\
  \u0431\u044B \u0438\u0437\u0431\u0435\u0436\u0430\u0442\u044C \u043E\u0448\u0438\
  \u0431\u043E\u043A, \u043D\u0430\u043F\u0440\u0438\u043C\u0435\u0440,\u2026"
lastmod: '2024-03-11T00:14:18.940716-06:00'
model: gpt-4-0125-preview
summary: "\u041F\u0440\u043E\u0432\u0435\u0440\u043A\u0430 \u0441\u0443\u0449\u0435\
  \u0441\u0442\u0432\u043E\u0432\u0430\u043D\u0438\u044F \u0434\u0438\u0440\u0435\u043A\
  \u0442\u043E\u0440\u0438\u0438 \u043E\u0437\u043D\u0430\u0447\u0430\u0435\u0442\
  \ \u043F\u043E\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043D\u0438\u0435\
  \ \u043D\u0430\u043B\u0438\u0447\u0438\u044F \u043F\u0430\u043F\u043A\u0438 \u0432\
  \ \u0444\u0430\u0439\u043B\u043E\u0432\u043E\u0439 \u0441\u0438\u0441\u0442\u0435\
  \u043C\u0435. \u041F\u0440\u043E\u0433\u0440\u0430\u043C\u043C\u0438\u0441\u0442\
  \u044B \u0434\u0435\u043B\u0430\u044E\u0442 \u044D\u0442\u043E, \u0447\u0442\u043E\
  \u0431\u044B \u0438\u0437\u0431\u0435\u0436\u0430\u0442\u044C \u043E\u0448\u0438\
  \u0431\u043E\u043A, \u043D\u0430\u043F\u0440\u0438\u043C\u0435\u0440,\u2026"
title: "\u041F\u0440\u043E\u0432\u0435\u0440\u043A\u0430 \u0441\u0443\u0449\u0435\u0441\
  \u0442\u0432\u043E\u0432\u0430\u043D\u0438\u044F \u0434\u0438\u0440\u0435\u043A\u0442\
  \u043E\u0440\u0438\u0438"
---

{{< edit_this_page >}}

## Что и Почему?

Проверка существования директории означает подтверждение наличия папки в файловой системе. Программисты делают это, чтобы избежать ошибок, например, попыток чтения из или записи в несуществующее место, что может привести к сбою программы или повреждению данных.

## Как сделать:

В стандартных библиотеках Lua нет встроенной обработки директорий. Часто используют `os.execute` с `test` на Unix или `os.getenv` на Windows. Вот как это делается:

```lua
local function is_directory_exists(path)
    if package.config:sub(1,1) == '\\' then -- проверка для Windows
        local cd_result = os.execute('cd ' .. path .. ' 2>nul')
        return cd_result == true or cd_result == 0
    else -- предполагаем систему похожую на Unix
        local test_result = os.execute('[ -d "' .. path .. '" ]')
        return test_result == true or test_result == 0
    end
end

print(is_directory_exists("/path/to/check/")) -- Системы похожие на Unix
print(is_directory_exists("C:\\path\\to\\check\\")) -- Системы Windows
```

Пример вывода может быть просто `true`, если директория существует, или `false`, если её нет.

## Подробнее

В ранние годы развития вычислительной техники управление файлами было критически важно в операционных системах, и проверка существования директорий выполнялась простыми командами оболочки. Lua, хотя и разработана для встраивания и расширения, остается минималистичной и, таким образом, полагается на внешние вызовы для таких задач.

Функция `os.execute` в Lua выполняет системную команду, делая её универсальной для этой цели. Системы на базе Unix хорошо реагируют на флаг `-d`, который проверяет наличие директорий. В Windows попытка смены директории с помощью `cd` служит нашей проверке.

Есть альтернативы, например, библиотека `lfs` (LuaFileSystem), которая предоставляет `lfs.attributes(path, "mode")`, более надежный и читаемый метод для выполнения той же задачи, но это требует установки дополнительных зависимостей.

По причинам производительности, прямые системные вызовы могут быть быстрее, чем использование полной библиотеки, особенно для простых задач, таких как проверка существования директории. Однако, использование `os.execute` имеет накладные расходы из-за создания нового процесса, поэтому будьте осторожны в плотном цикле.

## Смотрите также

- Документация LuaFileSystem: http://keplerproject.github.io/luafilesystem/manual.html
- Справочник по библиотеке `os` Lua: https://www.lua.org/manual/5.4/manual.html#6.9
- "Программирование на Lua" для более глубокого понимания языка: https://www.lua.org/pil/
